{% extends "core/base.html" %}
{% load static %}

<title> {% block title %}Profile{% endblock title %}</title>

{% block content %}

<div class="container">
  <div class="d-flex mt-4">
    <h2>Account</h2>
    {% if user.is_staff %}
      <ul class="ms-auto" style="list-style: none;">
        <li class="mb-1">
          <a href= '{% url "item:new" %}' class="text-decoration-none text-dark ">
            <img src="{% static "img/new.png" %}" width="20rem">
            <span class="fs-6">Add Items</span>
          </a>
        </li>
        <li>
          <a href="{% url "sign-out" %}" class="text-decoration-none text-dark">
            <img src="{% static "img/log-out.png" %}" width="20rem">
            <span class="fs-6">Sign out</span>
          </a>
        </li>
      </ul>
    {% else %}
      <a href="{% url "sign-out" %}" class="text-decoration-none text-dark ms-auto">
        <img src="{% static "img/log-out.png" %}" width="25rem">
        <span class="fs-6">Sign out</span>
      </a>
    {% endif %}
  </div>

  <div class="mt-3 mb-4">
    <span class="text-success-empahasis">Username : </span>{{ request.user.username }} <br>
    {% if request.user.get_full_name %}
      <span>Full Name : </span>{{ request.user.get_full_name }} <br>
    {% endif %}
      <span>E-mail : </span>{{ request.user.email }} <br>
      <br>
      <button onclick="location.href= '{% url "account:edit" %}' " class="btn btn-outline-warning text-dark">Edit</button>
      <hr>
  </div>

  <div>
    <h2>My Orders</h2>
    {% if orders %}
    {% for order in orders %}
    <div class="card bg-body-tertiary p-2 ps-3 mb-3">
      <div class="row">
        {% if order.status == 'ordered' %}
        <div class='mt-4'>
          <button class='btn btn-light p-0 position-absolute top-0 end-0' onclick="location.href= '{% url "order:cancel_order" order.id %}' ">
            <img src="{% static "img/bin.png" %}" ></img>
          </button>
        </div>
        {% endif %}
        <div class="d-flex mb-2">
          <span class="text-secondary me-auto">Order ID # {{ order.id }}</span>
          
          <!-- if ordered warning and if shipped success -->
          {% if order.status == 'ordered' %}
          <div class="ms-auto">
            <span class="badge bg-warning text-wrap rounded-pill">Ordered</span>
          </div>
          {% else %}
          <div>
            <span class="badge bg-success text-wrap rounded-pill">Shipped</span>
          </div>
          {% endif %}
          
        </div>
        <hr />

        {%  for order_item in order.orderitem_set.all %}
          <div class="col-lg-1 col-md-1 col-sm-1 col-3 mb-4">
            <a href="{% url 'item:detail' order_item.product.id %}">
              <img 
                src="{{ order_item.product.image.url }}" 
                alt='img'
                class="img-fluid" width="60rem"/>
            </a>
          </div>
            
          <div class="col-lg-4 col-md-4 col-sm-4 col-5">
            <div class="pt-2">
              {{ order_item.product.name }} <!-- Change here -->
              Product
            </div>
            {% if order_item.product.description %}
              <span class="text-secondary" style="font-size: .8rem;">
                {{ order_item.product.description }}
              </span>
            {% endif %}
          </div>
          
          <div class="col-lg-2 col-md-2 col-sm-2 col-4 mt-4">
            ₹ {{ order_item.product.price }} <!-- Change here -->
          </div>
          
          <!-- ------------ quantity ---------- -->
          <div class="col-lg-3 col-md-3 col-sm-3 col-5 mt-4">
            <div class="d-flex">
              <input  
                type="text" 
                class="text-center form-control" 
                value="{{ order_item.quantity }}" 
                style="width: 3rem; height: 1.5rem;" 
                readonly>
            </div>
          </div>
          
          <!-- --------------- subtotal ------------------ -->
          <div class="col-lg-2 col-md-2 col-sm-2 col-6 mt-4">
             ₹ {{ order_item.calculate_subtotal }}
          </div>
        {% endfor %}
        <hr>
        <div>Date : {{ order.created_at }}</div>
        <div>Total: {{ order.order_total }}</div>
      </div>
    </div>
  {% endfor %}
  {% else %}
  <p class="text-center text-body-tertiary">You haven't ordered anything yet</p>
  {% endif %}
</div>
{% endblock content %}